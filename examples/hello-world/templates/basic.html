<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>{{ name }}</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
      crossorigin="anonymous"
    />
    <script
      src="https://code.jquery.com/jquery-3.6.4.min.js"
      integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8="
      crossorigin="anonymous"
    ></script>
  </head>

  <body>
    <h1>{{ name }}</h1>
    <p>{{ markdown }}</p>
    <form id="form">
      {% for param in parameters %} <label> {{ param.name }} : </label> {% if
      param.type == 'text' %}
      <input type="text" name="{{ param.name }}" value="{{ param.default }}" />
      {% elif param.type == 'number' %}
      <input
        type="number"
        name="{{ param.name }}"
        value="{{ param.default }}"
      />
      {% elif param.type == 'single-choice' %}
      <select name="{{ param.name }}">
        {% for choice in param.choices %} {% if choice == param.default %}
        <option value="{{ choice }}" selected>{{ choice }}</option>
        {% else %}
        <option value="{{ choice }}">{{ choice }}</option>
        {% endif %} {% endfor %}
      </select>
      {% elif param.type == 'multi-choice' %} {% set defaults = param.default if
      param.default is iterable else [param.default] %} {% for choice in
      param.choices %}
      <label>
        <input
          type="checkbox"
          name="{{ param.name }}"
          value="{{ choice }}"
          {%
          if
          choice
          in
          defaults
          %}checked{%
          endif
          %}
        />
        {{ choice }}
      </label>
      {% endfor %} {% endif %} <br />{% endfor %}
      <input type="submit" value="Submit" />
    </form>
    <p>Run log :</p>
    <div id="run"></div>
    <p>Follow log:</p>
    <div id="log"></div>
    <p>Result log:</p>
    <div id="res"></div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
      crossorigin="anonymous"
    ></script>
    <script>
      $(document).ready(function () {
        $("#form").submit(function (e) {
          $.ajax({
            url: "/run",
            type: "POST",
            data: $("#form").serialize(),
            success: function (res) {
              console.log(res);
              $("#run").text(JSON.stringify(res));
            },
            // res is the response from the server
            // (from return request.data)
            error: function (error) {
              console.log(error);
              $("#run").text(JSON.stringify(error));
            },
          });
          e.preventDefault();
        });
      });
    </script>
  </body>
</html>
